<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satellite</title>
    <link rel="shortcut icon" href="https://www.pngall.com/wp-content/uploads/2016/04/Satellite-Download-PNG.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Satellite</h1>
    {% for entry in entries %}
       <p>{{ entry }}</p>
    {% endfor %}
    <a href="{{number}}/doppler" class="btn btn-primary">View Doppler Analysis</a>
    <div>
        <canvas id="myChart"></canvas>
        <script>
            const pointImage=new Image(50,50)
            pointImage.src= 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/FP_Satellite_icon.svg/1200px-FP_Satellite_icon.svg.png'
            //https://cdn-icons-png.flaticon.com/512/1679/1679957.png
            userLLA=[]
            userLLA.push({x: "{{userlong}}",y: "{{userlat}}"});
            long=[{% for item in longs %}
                "{{ item }}",
                {% endfor %}]

            lat=[{% for item in lats %}
                "{{ item }}",
                {% endfor %}]
                satPos=[];
                for(var j=1; j<long.length; j++) {
                    satPos.push({x: long[j],y: lat[j]});
                }
            wordlLat=[{% for item in worldLa %}
                "{{ item }}",
                {% endfor %}]

            worldLong=[{% for item in worldLo %}
                "{{ item }}",
                {% endfor %}]
                worldPos=[];
                for(var j=0; j<wordlLat.length; j++) {
                    worldPos.push({x: worldLong[j],y: wordlLat[j]});
                }

            Xvis=[{% for item in xvis %}
                "{{ item }}",
                {% endfor %}]

            Yvis=[{% for item in yvis %}
                "{{ item }}",
                {% endfor %}]
                visPos=[];
                for(var j=0; j<wordlLat.length; j++) {
                    visPos.push({x: Xvis[j],y: Yvis[j]});
                }
            const data = {
              datasets: [     
            {
                label: 'User Visibility',
                backgroundColor: 'rgb(49, 252, 83)',
                borderColor: 'rgb(49, 252, 83)',
                data: visPos,
                pointRadius:2,
            },        
            {
                label: 'Actual Position',
                backgroundColor: 'black',
                borderColor: 'black',
                data: [{x: long[0],y: lat[0]}],
                pointRadius: 7,
                pointStyle: pointImage
            },
            {
                label: 'Sat Position',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: satPos,
                pointRadius: 2,
              },
              {
                label: 'User Position',
                backgroundColor: 'yellow',
                borderColor: 'yellow',
                data: userLLA,
                pointRadius: 5,
              },
              {
                label: 'World',
                backgroundColor: 'blue',
                borderColor: 'blue',
                data: worldPos,
                pointRadius: 2,
              }]
            };
          
            const config = {
              type: 'scatter',
              data: data,
              options: {
                plugins: {
                    legend: {
                        labels: {
                            filter: item => {return item.text != "World"}
                        }
                    },
                },
                events: [],
                scales: {
                    x: {
                            max : 180,    
                            min : -180,
                        },
                    y: {
                            max : 90,    
                            min : -90,
                }}
            }};
            const myChart = new Chart(document.getElementById('myChart'),config);
        </script>
    </div>
</body>
</html>