<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satellite</title>
    <link rel="shortcut icon" href="https://www.pngall.com/wp-content/uploads/2016/04/Satellite-Download-PNG.png">
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var map, osm, esri, terreno;
        var controlCapas;
        var controlEscala;
    
        var locations = [
          ["LOCATION_1", 11.8166, 122.0942],
          ["LOCATION_2", 11.9804, 121.9189],
          ["LOCATION_3", 10.7202, 122.5621],
          ["LOCATION_4", 11.3889, 122.6277],
          ["LOCATION_5", 10.5929, 122.6325]];
        
        
    
        function init() {
            userLLA=[]
            userLLA.push(["{{userlat}}", "{{userlong}}"]);
            long=[{% for item in longs %}
                "{{ item }}",
                {% endfor %}]

            lat=[{% for item in lats %}
                "{{ item }}",
                {% endfor %}]
                satPos=[];
                for(var j=1; j<long.length; j++) {
                    satPos.push([lat[j], long[j]]);
                }

            Xvis=[{% for item in xvis %}
                "{{ item }}",
                {% endfor %}]

            Yvis=[{% for item in yvis %}
                "{{ item }}",
                {% endfor %}]
                visPos=[];
                for(var j=0; j<Xvis.length; j++) {
                    visPos.push([Yvis[j],Xvis[j]]);
                }
            map = L.map('map').setView([11.6863, 1.8382], 2);
    
            esri = L.tileLayer(
                'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                maxZoom: 6,
                minZoom: 2,
                attribution: 'Tiles Â© Esri',
            }).addTo(map);
    
            osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 6,
                minZoom: 2,
                attribution: 'OSM'
            });
    
            var baseMaps = {
                "Orto_esri": esri,
                "Mapa_osm": osm
            };

            var marker = L.marker(userLLA[0]).bindPopup("User position: Lat: "+userLLA[0][0]+ " Long: "+userLLA[0][1]).addTo(map);
            var polygon = L.polygon(visPos).addTo(map);
            var latlngs = [[45.51, -122.68],[37.77, -122.43],[34.04, -118.2]];
            var polyline = L.polyline(satPos, {color: 'red'}).addTo(map);
    
            controlCapas = L.control.layers(baseMaps);
            controlCapas.addTo(map);
    
            controlEscala = L.control.scale();
            controlEscala.addTo(map);
            
        }
    </script>
    <style>
    body {
        background-color:#383A3F;
    }
    canvas {
        background: blue;
    }
    p {
        color:white;
        font-size:12pt;
        font-family:arial,helvetica;
        padding-left: 20px;
      }
    h1 {
        color:white;
        font-size:36pt;
        font-family:verdana,arial;
        text-decoration:underline;
        text-align:center;
        margin-block-start: 0.3em;
        margin-block-end: 0.3em;
      }
    .btn {
        display: block;
        background:blue;
        font-family:verdana,arial;
        text-align: center;
        width: 100%;
        height: 60%;
        color: white;
        border-radius: 5px;
        padding: 10px 5px;
        box-shadow: rgba(0,0,0,0.9);
        transition: all 200ms ease-in-out;
        text-decoration: none;
      }
    .grid-container {
        display: grid;
        grid-template-columns: auto auto auto auto;
        grid-gap: 10px;
        padding: 10px;
    }
    .item1 {
        grid-row: 1 / span 2;
    }
    #map { 
        width: 90%;
        height: 900px;
        box-shadow: 5px 5px 5px #888;
    }
    </style>
</head>
<body onLoad="init()">
    <h1>Satellite</h1>
    <div class="grid-container">
        <div class="item1">
            {% for entry in entries %}
            <p>{{ entry }}</p>
            {% endfor %}
        </div>
        <div class="item2">
            <a href="{{number}}/doppler" class="btn">View Doppler Analysis</a>   
        </div>
    </div>
    <canvas id="myChart"></canvas>
        <script>
            const pointImage=new Image(50,50)
            pointImage.src= 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/FP_Satellite_icon.svg/1200px-FP_Satellite_icon.svg.png'
            //https://cdn-icons-png.flaticon.com/512/1679/1679957.png
            
            userLLA=[]
            userLLA.push({x: "{{userlong}}",y: "{{userlat}}"});
            long=[{% for item in longs %}
                "{{ item }}",
                {% endfor %}]

            lat=[{% for item in lats %}
                "{{ item }}",
                {% endfor %}]
                satPos=[];
                for(var j=1; j<long.length; j++) {
                    satPos.push({x: long[j],y: lat[j]});
                }

            wordlLat=[{% for item in worldLa %}
                "{{ item }}",
                {% endfor %}]

            worldLong=[{% for item in worldLo %}
                "{{ item }}",
                {% endfor %}]
                worldPos=[];
                for(var j=0; j<wordlLat.length; j++) {
                    worldPos.push({x: worldLong[j],y: wordlLat[j]});
                }

            Xvis=[{% for item in xvis %}
                "{{ item }}",
                {% endfor %}]

            Yvis=[{% for item in yvis %}
                "{{ item }}",
                {% endfor %}]
                visPos=[];
                for(var j=0; j<wordlLat.length; j++) {
                    visPos.push({x: Xvis[j],y: Yvis[j]});
                }
            const data = {
              datasets: [     
            {
                label: 'User Visibility',
                backgroundColor: 'white',
                borderColor: 'white',
                data: visPos,
                pointRadius:2,
            },        
            {
                label: 'Actual Position',
                backgroundColor: 'black',
                borderColor: 'black',
                data: [{x: long[0],y: lat[0]}],
                pointRadius: 7,
                pointStyle: pointImage
            },
            {
                label: 'Sat Position',
                backgroundColor: 'rgb(250, 32, 32)',
                borderColor: 'rgb(250, 32, 32)',
                data: satPos,
                pointRadius: 2,
              },
              {
                label: 'User Position',
                backgroundColor: 'yellow',
                borderColor: 'yellow',
                data: userLLA,
                pointRadius: 8,
                pointStyle: "rectRot"
              },
              {
                label: 'World',
                backgroundColor: 'rgb(0, 225, 0)',
                borderColor: 'rgb(0, 225, 0)',
                data: worldPos,
                pointRadius: 2,
              }]
            };
          
            const config = {
              type: 'scatter',
              data: data,
              options: {
                plugins: {
                    legend: {
                        labels: {
                            filter: item => {return item.text != "World"},
                            color: "white",
                        }
                    },
                },
                events: [],
                scales: {
                    x: {
                            max : 180,    
                            min : -180,
                            ticks: { color: 'white'},
                            grid: {color: 'white'},
                            title: {text: 'Longitude',color: 'white', display: true, align: 'center', font: {size:15}},
                        },
                    y: {
                            max : 90,    
                            min : -90,
                            ticks: { color: 'white'},
                            grid: {color: 'white'},
                            title: {text: 'Latitude',color: 'white', display: true, align: 'center', font: {size:15}},
                }}
            }};
            const myChart = new Chart(document.getElementById('myChart'),config);
        </script>
        <div id="map">
        </div>
</body>
</html>